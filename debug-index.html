<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parking4Free - Debug Version</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { padding: 10px 20px; margin: 5px; }
        input { padding: 8px; margin: 5px; width: 200px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: white; margin: 15% auto; padding: 20px; border-radius: 5px; width: 300px; }
    </style>
</head>
<body>
    <h1>Parking4Free - Debug Version</h1>
    
    <div class="debug">
        <h3>API-Konfiguration:</h3>
        <div id="config-info">Lade...</div>
    </div>

    <div class="debug">
        <h3>Backend-Test:</h3>
        <button onclick="testBackend()">Backend testen</button>
        <div id="backend-result"></div>
    </div>

    <div class="debug">
        <h3>Login-Test:</h3>
        <button onclick="showLoginModal()">Login öffnen</button>
        <div id="login-result"></div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <h2>Login</h2>
            <form id="login-form">
                <div>
                    <label>Email:</label>
                    <input type="email" id="login-email" value="admin@parking4free.de" required>
                </div>
                <div>
                    <label>Passwort:</label>
                    <input type="password" id="login-password" value="admin123" required>
                </div>
                <button type="submit">Anmelden</button>
                <button type="button" onclick="hideLoginModal()">Abbrechen</button>
            </form>
        </div>
    </div>

    <script>
        // API-Konfiguration
        const API_BASE_URL = 'https://parking4free-backend.onrender.com/api';
        
        document.getElementById('config-info').innerHTML = `
            <strong>API URL:</strong> ${API_BASE_URL}<br>
            <strong>Hostname:</strong> ${window.location.hostname}
        `;

        async function testBackend() {
            const resultDiv = document.getElementById('backend-result');
            resultDiv.innerHTML = 'Teste Backend...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<div class="success">✅ Backend funktioniert: ${JSON.stringify(data)}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="error">❌ Backend-Fehler: ${response.status}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ Verbindungsfehler: ${error.message}</div>`;
            }
        }

        function showLoginModal() {
            document.getElementById('login-modal').style.display = 'block';
        }

        function hideLoginModal() {
            document.getElementById('login-modal').style.display = 'none';
        }

        // Login-Handler
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const resultDiv = document.getElementById('login-result');
            
            resultDiv.innerHTML = 'Login läuft...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.innerHTML = `<div class="success">✅ Login erfolgreich! Benutzer: ${data.user.name}</div>`;
                    hideLoginModal();
                } else {
                    resultDiv.innerHTML = `<div class="error">❌ Login fehlgeschlagen: ${data.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ Verbindungsfehler: ${error.message}</div>`;
            }
        });

        // Automatisch Backend testen
        window.onload = testBackend;
    </script>
</body>
</html>
